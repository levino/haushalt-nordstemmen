---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const haushalte = await getCollection('haushalte');
const sortedHaushalte = haushalte.sort((a, b) => b.data.jahr - a.data.jahr);
---

<Layout title="Datenquellen">
  <section class="section">
    <div class="container">
      <h1>Datenquellen</h1>
      <p>
        Alle Haushaltsdaten stammen aus offiziellen Quellen und sind vollständig nachvollziehbar.
        Für die Jahre 2010-2024 werden Ist-Ergebnisse aus den Jahresabschlüssen verwendet,
        für 2025-2029 die Planwerte aus dem aktuellen Haushaltsplan.
      </p>

      <h2>Primärquelle</h2>

      <div class="card">
        <h3>Ratsinformationssystem Nordstemmen</h3>
        <p>
          Die Gemeinde Nordstemmen veröffentlicht alle Rats- und Ausschussdokumente
          über das Ratsinformationssystem. Alle hier verwendeten Daten stammen aus
          den dort veröffentlichten Haushaltsplänen und Jahresabschlüssen.
        </p>
        <table>
          <tr>
            <td><strong>URL</strong></td>
            <td><a href="https://nordstemmen.ratsinfomanagement.net" target="_blank">nordstemmen.ratsinfomanagement.net</a></td>
          </tr>
          <tr>
            <td><strong>API-Standard</strong></td>
            <td>OParl v1.1</td>
          </tr>
          <tr>
            <td><strong>Daten seit</strong></td>
            <td>2007</td>
          </tr>
        </table>
      </div>

      <h2>Quelldokumente je Haushaltsjahr</h2>
      <p>
        Für jedes Jahr ist das offizielle Quelldokument verlinkt.
        Bei abgeschlossenen Jahren sind das die Jahresabschlüsse (Ist-Ergebnisse),
        bei zukünftigen Jahren die Haushaltspläne (Plan-Werte).
      </p>

      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Jahr</th>
              <th>Typ</th>
              <th>Quelldokument</th>
              <th>Link</th>
            </tr>
          </thead>
          <tbody>
            {sortedHaushalte.map(h => (
              <tr>
                <td><a href={`/haushalt/${h.data.jahr}`}>{h.data.jahr}</a></td>
                <td>
                  <span class={`badge ${h.data.typ === 'ist' ? 'badge-ist' : 'badge-plan'}`}>
                    {h.data.typ === 'ist' ? 'Ist' : 'Plan'}
                  </span>
                </td>
                <td>{h.data.quelle}</td>
                <td>
                  {h.data.quelle_url
                    ? <a href={h.data.quelle_url} target="_blank" class="btn btn-small">PDF</a>
                    : <span class="text-muted">-</span>}
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      <h2>Strukturierte Daten</h2>

      <div class="card">
        <h3>GitHub Repository</h3>
        <p>
          Alle Daten sind im Repository als JSON verfügbar.
          Die Datenextraktion ist vollständig reproduzierbar.
        </p>
        <ul>
          <li><code>src/content/haushalte/*.json</code> - Jahresweise Haushaltsdaten (2010-2029)</li>
          <li><code>src/content/config.ts</code> - Schema-Definition (Zod)</li>
        </ul>
        <a href="https://github.com/levino/haushalt-nordstemmen" target="_blank" class="btn btn-secondary">Zum Repository</a>
      </div>

      <h2>Weitere Datenquellen</h2>

      <div class="card">
        <h3>LSN-Online Datenbank</h3>
        <p>
          Die LSN-Online Datenbank des Landesamts für Statistik Niedersachsen enthält
          historische Gemeindefinanzdaten und kann für Vergleiche mit anderen Kommunen genutzt werden.
        </p>
        <table>
          <tr>
            <td><strong>URL</strong></td>
            <td><a href="https://www1.nls.niedersachsen.de/statistik/" target="_blank">www1.nls.niedersachsen.de/statistik</a></td>
          </tr>
          <tr>
            <td><strong>Gemeindeschlüssel</strong></td>
            <td>03254035 (Nordstemmen)</td>
          </tr>
        </table>
        <a href="/lsn-datenbank" class="btn btn-secondary">Technische Dokumentation</a>
      </div>
    </div>
  </section>
</Layout>

<style>
  .card {
    margin-bottom: 1.5rem;
  }

  .card h3 {
    margin-bottom: 0.5rem;
  }

  .card ul {
    margin: 1rem 0;
    padding-left: 1.5rem;
  }

  .card li {
    margin-bottom: 0.5rem;
  }

  code {
    background: var(--color-bg-alt);
    padding: 0.125rem 0.375rem;
    border-radius: 4px;
    font-size: 0.875rem;
  }

  .table-wrapper {
    overflow-x: auto;
  }

  .badge {
    display: inline-block;
    padding: 0.125rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
  }

  .badge-ist {
    background: #c6f6d5;
    color: #22543d;
  }

  .badge-plan {
    background: #bee3f8;
    color: #2a4365;
  }

  .btn-small {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    font-size: 0.75rem;
    background: var(--color-secondary);
    color: white;
    text-decoration: none;
    border-radius: 4px;
  }

  .btn-small:hover {
    opacity: 0.9;
  }

  .text-muted {
    color: var(--color-text-light);
  }
</style>
